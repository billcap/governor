master:
    build: .
    volumes:
        - '/tmp/master:/pg.data'
        - './example.initdb.d:/docker-entrypoint-initdb.d'
    ports:
        - '5999:5999'
    links:
        - etcd
    command: >
        python3 governor.py
        --dbname postgres
        --data-dir /pg.data
        --listen-address 0.0.0.0:5999
        --advertise-url=10.176.160.104:5999
        --etcd-url=http://etcd:4001
        -o
        "-c max_replication_slots=5
        -c archive_mode=on
        -c wal_level=hot_standby
        -c max_wal_senders=5
        -c wal_keep_segments=8
        -c archive_timeout=1800s
        -c max_replication_slots=5
        -c hot_standby=on
        -c logging_collector=on
        "
    #-c archive_command='mkdir -p /wal_archive && cp %p /wal_archive/%f'

#slave:
    #build: .
    #volumes:
        #- /tmp/slave:/pg.data
    #expose:
        #- 5432
    #command: postgres -i

etcd:
    image: quay.io/coreos/etcd:v2.0.13
    volumes:
        - '/tmp/etcd:/data'
    expose:
        - 4001
    command: --data-dir /data --name etcd --advertise-client-urls http://127.0.0.1:4001 --listen-client-urls http://0.0.0.0:4001
